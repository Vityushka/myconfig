  utility_value_from_j3455:
    alias: Utility value from Main Server
    sequence:
      - service: input_number.set_value
        data_template:
              entity_id: input_number.power_t1
              value: "{{ states('sensor.power_t1_j3455')|float }}"
      - service: input_number.set_value
        data_template:
              entity_id: input_number.power_t2
              value: "{{ states('sensor.power_t2_j3455')|float }}"
      - service: input_number.set_value
        data_template:
              entity_id: input_number.power_consumption_month_t1
              value: "{{ states('sensor.power_consumption_month_t1_j3455')|float }}"
      - service: input_number.set_value
        data_template:
              entity_id: input_number.power_consumption_month_t2
              value: "{{ states('sensor.power_consumption_month_t2_j3455')|float }}"
      
      - service: input_number.set_value
        data_template:
              entity_id: input_number.cold_water_meter
              value: "{{ states('sensor.cold_water_meter_j3455')|float}}"
      - service: input_number.set_value
        data_template:
              entity_id: input_number.hot_water_meter
              value: "{{ states('sensor.hot_water_meter_j3455')|float}}"
      
      - service: input_number.set_value
        data_template:
              entity_id: input_number.cold_water_meter_month
              value: "{{ states('sensor.cold_water_meter_month_j3455')|int(0) }}"
      - service: input_number.set_value
        data_template:
              entity_id: input_number.hot_water_meter_month
              value: "{{ states('sensor.hot_water_meter_month_j3455')|int(0) }}"

  utility_value_from_rpi:
    alias: Utility value from RPI Server
    sequence:
      - service: input_number.set_value
        data_template:
              entity_id: input_number.power_t1
              value: "{{ states('sensor.power_t1_rpi')|float }}"
      - service: input_number.set_value
        data_template:
              entity_id: input_number.power_t2
              value: "{{ states('sensor.power_t2_rpi')|float }}"
      - service: input_number.set_value
        data_template:
              entity_id: input_number.power_consumption_month_t1
              value: "{{ states('sensor.power_consumption_month_t1_rpi')|float }}"
      - service: input_number.set_value
        data_template:
              entity_id: input_number.power_consumption_month_t2
              value: "{{ states('sensor.power_consumption_month_t2_rpi')|float }}"
      
      - service: input_number.set_value
        data_template:
              entity_id: input_number.cold_water_meter
              value: "{{ states('sensor.cold_water_meter_rpi')|float}}"
      - service: input_number.set_value
        data_template:
              entity_id: input_number.hot_water_meter
              value: "{{ states('sensor.hot_water_meter_rpi')|float}}"
      
      - service: input_number.set_value
        data_template:
              entity_id: input_number.cold_water_meter_month
              value: "{{ states('sensor.cold_water_meter_month_rpi')|int(0) }}"
      - service: input_number.set_value
        data_template:
              entity_id: input_number.hot_water_meter_month
              value: "{{ states('sensor.hot_water_meter_month_rpi')|int(0) }}"

  power_t1:
    alias: Power Consumption T1
    sequence:
      - service: input_number.set_value
        data_template:
            entity_id: input_number.power_t1
            value: "{{ (states('input_number.power_t1')|float + states('sensor.power_consumption')|float / 120000) | round(2) }}"
  
  power_t2:
    alias: Power Consumption T2
    sequence:
      - service: input_number.set_value
        data_template:
            entity_id: input_number.power_t2
            value: "{{ (states('input_number.power_t2')|float + states('sensor.power_consumption')|float / 120000) | round(2) }}"
  
  power_m_t1:
    alias: Power Consumption T1/Month
    sequence:
      - service: input_number.set_value
        data_template:
            entity_id: input_number.power_consumption_month_t1
            value: "{{ (states('input_number.power_consumption_month_t1')|float + states('sensor.power_consumption')|float / 120000) | round(2) }}"
  
  power_m_t2:
    alias: Power Consumption T2/Month
    sequence:
      - service: input_number.set_value
        data_template:
            entity_id: input_number.power_consumption_month_t2
            value: "{{ (states('input_number.power_consumption_month_t2')|float + states('sensor.power_consumption')|float / 120000) | round(2) }}"
  
  
  system_water_new_month_action:
    alias: Water Consumption Report
    sequence:
      - service: notify.telegram
        data_template: 
          message: >-
              Холодная вода: {{ ((states('sensor.cold_water_meter'))|float)}} м3
              Горячая вода: {{ ((states('sensor.hot_water_meter'))|float)}} м3
              
              
              Расход за месяц:
              Холодная вода: {{ (((states('sensor.cold_water_month'))|float)/100)|round(2) }} м3
              Горячая вода: {{ (((states('sensor.hot_water_month'))|float)/100)|round(2) }} м3
              Стоимость: {{ ((states('sensor.water_cost'))|float)}} руб.
      - delay:
          seconds: 1
      - service: input_number.set_value
        data_template:
          entity_id: input_number.hot_water_meter_month, input_number.cold_water_meter_month
          value: 0

  
  system_power_new_month_action:
    alias: Power Consumption Report
    sequence:
      - service: notify.telegram
        data_template: 
          message: >-
              Электричество (день) Т1: {{ ((states('sensor.power_t1'))|float)}} кВт*ч
              Электричество (ночь) Т2: {{ ((states('sensor.power_t2'))|float)}} кВт*ч
            
              
              Расход за месяц:
              Электричество (день) Т1: {{ ((states('sensor.power_consumption_month_t1'))|float)}} кВт*ч
              Электричество (ночь) Т2: {{ ((states('sensor.power_consumption_month_t2'))|float)}} кВт*ч
              Стоимость: {{ ((states('sensor.power_consumption_month_cost'))|float) }} руб.
      - service: input_number.set_value
        data_template:
          entity_id: input_number.power_consumption_month_t1, input_number.power_consumption_month_t2
          value: 0