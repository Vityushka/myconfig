  - platform: template
    sensors:

      ippon_hb_status:
        friendly_name: Ippon 1050 Status HB
        value_template: >
          {% if states.sensor.ippon_hb_status_data == none %}
          false
          {% else %}
          true
          {% endif %}
        icon_template: mdi:battery
        device_class: power
      
      ippon_mb_status:
        friendly_name: Ippon 650 Status MB
        value_template: >
          {% if states.sensor.ippon_mb_status_data == none %}
          false
          {% else %}
          true
          {% endif %}
        icon_template: mdi:battery
        device_class: power


      family_home:
        friendly_name: Family Home
        device_class: presence
        value_template: >
          {{ is_state('person.dima', 'home') or
             is_state('person.sandra', 'home') or
             is_state('person.vova','home') or
             is_state('input_boolean.sasha_tracker','on')
          }}
    
      cold_water_usage_changed:
        friendly_name: Cold Water Usage Changed
        value_template: >-
          {{ state_attr('sensor.cold_water_usage_mean', 'change') | float > 0.01 }}
      hot_water_usage_changed:
        friendly_name: Hot Water Usage Changed
        value_template: >-
          {{ state_attr('sensor.hot_water_usage_mean', 'change') | float > 0.01 }}
      motion_hb:
        friendly_name: Motion HB
        value_template: >-
            {{ is_state('binary_sensor.motion_sensor_158d0002b482e9', 'on')
              or is_state('binary_sensor.motion_sensor_158d0001e05856', 'on') }}
      sasha:
        friendly_name: Sasha tracker
        value_template: >-
          {{ is_state('input_boolean.sasha_tracker', 'on') }}
      dima:
        friendly_name: Sasha tracker
        value_template: >-
          {{ is_state('person.dima', 'home') }}
      sandra:
        friendly_name: Sandra tracker
        value_template: >-
          {{ is_state('person.sandra', 'home') }}
      vova:
        friendly_name: Vova tracker
        value_template: >-
          {{ is_state('person.vova', 'home') }}
# ############################################################################
# Security 
# ############################################################################
      security:
        friendly_name: Security mode
        value_template: "{{ is_state('input_boolean.security_mode', 'on') }}"
        icon_template: >
          {% if is_state('input_boolean.security_mode', 'on') %}
            mdi:shield
          {% elif is_state('input_boolean.security_mode', 'off') %}
            mdi:shield-off
          {% endif %}
      
      motion_internal:
        friendly_name: Motion Internal
        value_template: "{{ is_state('group.motioninternal','on') }}"
      
      motion:
        friendly_name: Motion
        value_template: "{{ is_state('group.motion','on') }}"
        #icon_template: >-
        #  {%if states.group.motion.state == 'on' %}
        #  mdi:run
        #  {% else %}
        #  mdi:walk
        #  {% endif %}
    
      motion_unifi:
        friendly_name: Motion Unifi
        value_template: "{{ is_state('group.motionunifi','on') }}"
        #icon_template: >-
        #  {%if states.group.motionunifi.state == 'on' %}
        #  mdi:run
        #  {% else %}
        #  mdi:walk
        #  {% endif %}
      
      doors:
        friendly_name: Doors
        value_template: "{{ is_state('group.doors','on') }}"
        #icon_template: >-
        #  {%if states.group.doors.state == 'on' %}
        #  mdi:door-open
        #  {% else %}
         # mdi:door-closed
        #  {% endif %}


      windows:
        friendly_name: Windows
        value_template: "{{ is_state('group.windows','on') }}"
        #icon_template: >-
        #  {%if states.group.windows.state == 'on' %}
        #  mdi:window-open
        #  {% else %}
        #  mdi:window-closed
        #  {% endif %}




# ############################################################################
# MQTT Unifi Mition Detector
# ############################################################################
  - platform: mqtt
    state_topic: "camera/motion/kitchen/#"
    name: Unifi Motion Kitchen
    
  - platform: mqtt
    state_topic: "camera/motion/hall/#"
    name: Unifi Motion Hall
    
  - platform: mqtt
    state_topic: "camera/motion/entrance/#"
    name: Unifi Motion Entrance
    
  - platform: mqtt
    state_topic: "camera/motion/window/#"
    name: Unifi Motion Window
    
#      "{% if is_state('input_boolean.sasha_tracker', 'on') %}home{% else %}not_home{% endif %}"